# üíæ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ - –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è

## üìã –û–±–∑–æ—Ä

–ë–æ—Ç —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **SQLite** –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è:
- üë• –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è—Ö
- üí∞ –ò—Å—Ç–æ—Ä–∏—è –≤—Å–µ—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π (QR-–∫–æ–¥–æ–≤)
- üìä –°–æ–±—ã—Ç–∏—è –∏ –¥–µ–π—Å—Ç–≤–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ
- ‚úÖ –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏ –æ—Ç—á–µ—Ç—ã
- ‚úÖ –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö —É—Å–ª—É–≥
- ‚úÖ –ò—Å—Ç–æ—Ä–∏—è –ø–æ –¥–Ω—è–º

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è

–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Å–æ–∑–¥–∞–µ—Ç—Å—è **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏** –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ –±–æ—Ç–∞:

```bash
python qr.py
```

–í—ã —É–≤–∏–¥–∏—Ç–µ –≤ –ª–æ–≥–∞—Ö:
```
‚úÖ Database module loaded successfully
Database initialized at bot_stats.db
```

---

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### –¢–∞–±–ª–∏—Ü–∞ `users`
–•—Ä–∞–Ω–∏—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è—Ö:
- `user_id` - Telegram ID (–ø–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á)
- `username` - Username
- `first_name`, `last_name` - –ò–º—è –∏ —Ñ–∞–º–∏–ª–∏—è
- `first_seen`, `last_seen` - –î–∞—Ç—ã –ø–µ—Ä–≤–æ–≥–æ –∏ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –≤–∏–∑–∏—Ç–∞
- `total_requests` - –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤
- `is_admin` - –§–ª–∞–≥ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞

### –¢–∞–±–ª–∏—Ü–∞ `transactions`
–•—Ä–∞–Ω–∏—Ç –≤—Å–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ (—Å–æ–∑–¥–∞–Ω–Ω—ã–µ QR-–∫–æ–¥—ã):
- `id` - –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- `user_id` - ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `amount` - –°—É–º–º–∞ –≤ CZK
- `service` - –ù–∞–∑–≤–∞–Ω–∏–µ —É—Å–ª—É–≥–∏ (–º–æ–∂–µ—Ç –±—ã—Ç—å NULL)
- `timestamp` - –î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è

### –¢–∞–±–ª–∏—Ü–∞ `events`
–•—Ä–∞–Ω–∏—Ç —Å–æ–±—ã—Ç–∏—è (–¥–µ–π—Å—Ç–≤–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π):
- `id` - –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID
- `user_id` - ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `event_type` - –¢–∏–ø —Å–æ–±—ã—Ç–∏—è (start, payment_start, qr_generated)
- `event_data` - –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- `timestamp` - –î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è

---

## üì± –ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞ —Å –ë–î

### `/stats` - –ë–∞–∑–æ–≤–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (–∞–¥–º–∏–Ω)

–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç:
- üë• –í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- üí∞ –í—Å–µ–≥–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
- üíµ –û–±—â—É—é —Å—É–º–º—É
- üìä –°—Ä–µ–¥–Ω—é—é —Å—É–º–º—É
- üü¢ –ê–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞ 24 —á–∞—Å–∞
- **–¢–æ–ø-5 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π** —Å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º QR –∏ —Å—É–º–º–∞–º–∏
- **–¢–æ–ø-5 –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö —É—Å–ª—É–≥**

**–ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞:**
```
üìä –°–¢–ê–¢–ò–°–¢–ò–ö–ê –ë–û–¢–ê (–ë–î)

üë• –í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: 15
üí∞ –í—Å–µ–≥–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π: 47
üíµ –û–±—â–∞—è —Å—É–º–º–∞: 68,500 CZK
üìä –°—Ä–µ–¥–Ω—è—è —Å—É–º–º–∞: 1,457 CZK
üü¢ –ê–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞ 24—á: 5

–¢–æ–ø –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:
1. @username1: 12 QR, 18,000 CZK
2. @username2: 8 QR, 12,400 CZK
3. @username3: 6 QR, 9,000 CZK
4. @username4: 5 QR, 7,500 CZK
5. @username5: 4 QR, 6,000 CZK

–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —É—Å–ª—É–≥–∏:
1. LAMINACE RAS: 15x
2. √öPRAVA A BARVEN√ç: 12x
3. LAMINACE RAS + √öPRAVA: 8x
4. ZESVƒöTLEN√ç: 6x
5. L√çƒåEN√ç & √öƒåES: 4x
```

---

## üîß –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö

### –†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ —Ñ–∞–π–ª–∞

- **–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é:** `bot_stats.db` (–≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞)
- **–ù–∞—Å—Ç—Ä–æ–π–∫–∞:** –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–∫—Ä—É–∂–µ–Ω–∏—è `DATABASE_PATH`

```env
# –í .env:
DATABASE_PATH=/path/to/custom/database.db
```

### –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –°–æ–∑–¥–∞—Ç—å backup
cp bot_stats.db bot_stats_backup_$(date +%Y%m%d).db

# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–∑ backup
cp bot_stats_backup_20241009.db bot_stats.db
```

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ë–î (SQLite Browser)

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ **DB Browser for SQLite** (–±–µ—Å–ø–ª–∞—Ç–Ω–æ):
- Download: https://sqlitebrowser.org/
- Open: `bot_stats.db`
- Browse Data ‚Üí –≤—ã–±–µ—Ä–∏—Ç–µ —Ç–∞–±–ª–∏—Ü—É

### SQL –∑–∞–ø—Ä–æ—Å—ã

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å SQLite CLI
sqlite3 bot_stats.db

# –ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤:
sqlite> SELECT * FROM transactions ORDER BY timestamp DESC LIMIT 10;
sqlite> SELECT service, COUNT(*) FROM transactions GROUP BY service;
sqlite> SELECT SUM(amount) FROM transactions WHERE date(timestamp) = date('now');
sqlite> .exit
```

---

## üìà –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞

### –ú–æ–¥—É–ª—å `analytics.py`

–ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ—Ç—á–µ—Ç—ã:

```python
from analytics import (
    format_daily_report,      # –î–Ω–µ–≤–Ω–æ–π –æ—Ç—á–µ—Ç –∑–∞ 7 –¥–Ω–µ–π
    format_services_report,   # –î–µ—Ç–∞–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç –ø–æ —É—Å–ª—É–≥–∞–º
    format_users_report,      # –î–µ—Ç–∞–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º
    format_summary_report     # –û–±—â–∏–π –æ—Ç—á–µ—Ç —Å –ø–æ—Å–ª–µ–¥–Ω–∏–º–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏
)

# –ü–æ–ª—É—á–∏—Ç—å –æ—Ç—á–µ—Ç
print(format_daily_report())
```

### –ó–∞–ø—É—Å–∫ –≤—Ä—É—á–Ω—É—é

```bash
python analytics.py
```

**–í—ã–≤–æ–¥:**
- –û–±—â–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞
- –î–Ω–µ–≤–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞ 7 –¥–Ω–µ–π
- –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —É—Å–ª—É–≥–∏ —Å –ø—Ä–æ—Ü–µ–Ω—Ç–∞–º–∏
- –ê–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ (—Ç–æ–ø-10)

---

## üîç –û—Ç–ª–∞–¥–∫–∞ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã –ë–î

```python
# –ó–∞–ø—É—Å—Ç–∏—Ç–µ database.py –Ω–∞–ø—Ä—è–º—É—é –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
python database.py
```

**–û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥:**
```
üß™ Testing database module...
‚úÖ User added
‚úÖ Transaction added
‚úÖ User stats: {...}
‚úÖ Total stats: {...}
‚úÖ All tests passed!
```

### –õ–æ–≥–∏

–ë–æ—Ç –ª–æ–≥–∏—Ä—É–µ—Ç –≤—Å–µ –¥–µ–π—Å—Ç–≤–∏—è —Å –ë–î:
```
‚úÖ Database module loaded successfully
Transaction added: user=123456, amount=1500.0, service=LAMINACE RAS
Database error: ... (–µ—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫)
```

### Fallback —Ä–µ–∂–∏–º

–ï—Å–ª–∏ –ë–î –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞, –±–æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **in-memory —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É**:
```
‚ö†Ô∏è Database module not found, using in-memory stats
üìä –°–¢–ê–¢–ò–°–¢–ò–ö–ê –ë–û–¢–ê (–ø–∞–º—è—Ç—å)  # –≤–º–µ—Å—Ç–æ (–ë–î)
```

---

## üö® Troubleshooting

### "Database is locked"
```bash
# –ó–∞–∫—Ä–æ–π—Ç–µ –≤—Å–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–µ—Ç –ª–∏ –¥—Ä—É–≥–∏—Ö —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤ –±–æ—Ç–∞
ps aux | grep qr.py
kill <PID>
```

### "No module named database"
```bash
# –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ database.py –≤ —Ç–æ–π –∂–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ —á—Ç–æ –∏ qr.py
ls -la database.py
```

### –ë–î –Ω–µ —Å–æ–∑–¥–∞–µ—Ç—Å—è
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –Ω–∞ –∑–∞–ø–∏—Å—å
chmod 755 .
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –º–µ—Å—Ç–æ –Ω–∞ –¥–∏—Å–∫–µ
df -h
```

### –ú–∏–≥—Ä–∞—Ü–∏—è —Å—Ç–∞—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö

–ï—Å–ª–∏ —É –≤–∞—Å –±—ã–ª–∞ —Å—Ç–∞—Ä–∞—è –≤–µ—Ä—Å–∏—è –±–µ–∑ –ë–î:
```python
# –°—Ç–∞—Ä–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤ –ø–∞–º—è—Ç–∏ –Ω–µ –ø–µ—Ä–µ–Ω–æ—Å–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
# –ù–æ –Ω–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –ë–î —Å –ø–µ—Ä–≤–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞
```

---

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –î–æ–±–∞–≤—å—Ç–µ –≤ .gitignore

–£–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ:
```
bot_stats.db
bot_stats.db-journal
*.db
*.db-journal
```

### –ù–∞ Render

–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –±—É–¥–µ—Ç **—Å–±—Ä–∞—Å—ã–≤–∞—Ç—å—Å—è –ø—Ä–∏ –∫–∞–∂–¥–æ–º –¥–µ–ø–ª–æ–µ** –Ω–∞ Render Free Plan.

**–†–µ—à–µ–Ω–∏—è:**
1. **Render Paid Plan** - –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω—ã–π –¥–∏—Å–∫
2. **–í–Ω–µ—à–Ω—è—è –ë–î** - PostgreSQL (Render –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç)
3. **–≠–∫—Å–ø–æ—Ä—Ç –≤ Google Sheets** - –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–π backup

---

## üìù API Reference

### Database –∫–ª–∞—Å—Å

```python
from database import db

# –î–æ–±–∞–≤–∏—Ç—å/–æ–±–Ω–æ–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
db.add_or_update_user(user_id, username, first_name, last_name, is_admin)

# –î–æ–±–∞–≤–∏—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é
db.add_transaction(user_id, amount, service)

# –î–æ–±–∞–≤–∏—Ç—å —Å–æ–±—ã—Ç–∏–µ
db.add_event(user_id, event_type, event_data)

# –ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
stats = db.get_user_stats(user_id)

# –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
users = db.get_all_users_stats()

# –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
total = db.get_total_stats()

# –ü–æ—Å–ª–µ–¥–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
recent = db.get_recent_transactions(limit=10)

# –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —É—Å–ª—É–≥–∏
services = db.get_popular_services(limit=10)

# –î–Ω–µ–≤–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
daily = db.get_daily_stats(days=7)
```

---

## üéØ –ë—É–¥—É—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

- [ ] –≠–∫—Å–ø–æ—Ä—Ç –≤ CSV/Excel
- [ ] –ì—Ä–∞—Ñ–∏–∫–∏ –∏ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è
- [ ] Email –æ—Ç—á–µ—Ç—ã
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Google Sheets
- [ ] PostgreSQL –¥–ª—è production
- [ ] Webhook –¥–ª—è real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π

---

**–í–µ—Ä—Å–∏—è:** 1.0  
**–î–∞—Ç–∞:** 9 –æ–∫—Ç—è–±—Ä—è 2024  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ Production Ready
